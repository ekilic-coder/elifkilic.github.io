<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quetzal: Glide → Orbit → Freeze</title>
<style>
  :root{
    --glide-height: 170px;
    --orbit-size: 260px;
    --globe-size: 240px;
    --quetzal-size: 240px;  /* visual size of the flying asset */
    --orbit-radius: 155px;
  }

  body{ margin:0; font-family: system-ui, sans-serif; background:#fafafa; color:#111; }

  /* ===== HERO GLIDE STRIP ===== */
  .hero {
    position: relative;
    width: 100%;
    height: var(--glide-height);
    overflow: hidden;
    background: linear-gradient(to top,#e8fbff,#fff);
  }

  /* The first-visit only flyer; can be <video> (alpha webm) or <img> (animated webp) */
  .intro-flyer {
    position: absolute;
    top: 42%;
    left: -340px;                    /* start off-screen */
    width: var(--quetzal-size);
    height: auto;
    transform-origin: 25% 60%;
    animation:
      intro-glide var(--intro-glide-duration, 5000ms) linear 1,
      bob 4s ease-in-out infinite,
      sway 1.6s ease-in-out infinite;
    will-change: transform;
    pointer-events: none;
  }

  @keyframes intro-glide {
    0%   { transform: translateX(0) translateY(0) rotate(-3deg); }
    100% { transform: translateX(calc(100vw + 680px)) translateY(0) rotate(3deg); }
  }
  @keyframes bob { 0%,100% { transform: translateY(0) } 50% { transform: translateY(-10px) } }
  @keyframes sway {
    0%,100% { rotate: 0deg; }
    25%     { rotate: 2deg; }
    50%     { rotate: -2.5deg; }
    75%     { rotate: 1.5deg; }
  }

  /* ===== ORBIT BLOCK ===== */
  .logo-block{ padding: 40px 0; display:grid; place-items:center; }
  .orbit-wrap{
    position: relative;
    width: var(--orbit-size);
    height: var(--orbit-size);
  }
  .globe{
    position: absolute; inset: 0; margin: auto;
    width: var(--globe-size); height: var(--globe-size);
  }

  /* The orbiting bird (same asset, positioned over the globe area) */
  .orbit-bird{
    position: absolute;
    left: 50%; top: 50%;
    width: calc(var(--quetzal-size) * 0.5); /* smaller near globe */
    height: auto;
    transform: translate(-50%,-50%) rotate(0deg) translateX(var(--orbit-radius)) rotate(0deg);
    transform-origin: center;
    pointer-events: none;
    will-change: transform;
  }

  .spacer{ height: 24px; }

  @media (prefers-reduced-motion: reduce){
    .intro-flyer{ animation: none; left: 10px }
  }
</style>
</head>
<body>

<header class="hero" id="hero">
  <!-- First-visit flyer is injected here by JS -->
  <!-- Fallback (no JS): nothing visible, page stays calm -->
</header>

<div class="spacer"></div>

<section class="logo-block">
  <div class="orbit-wrap" id="orbitWrap">
    <img class="globe" src="globe_logo.png" alt="Globe" width="240" height="240" />
    <!-- Orbit bird: choose ONE of the two sources below and remove the other -->
    <!-- If you have alpha video -->
    <video id="orbitBird" class="orbit-bird" src="quetzal_alpha.webm" muted playsinline loop></video>
    <!-- If you have animated webp instead, comment out the video above and uncomment this: -->
    <!-- <img id="orbitBird" class="orbit-bird" src="quetzal_flight.webp" alt="Quetzal" /> -->
  </div>
</section>

<script>
/** CONFIG **/
const C = {
  key: 'quetzalIntroSeen_v2',
  introMs: 5000,          // glide duration (matches CSS var)
  orbitMs: 3800,          // time flying around globe before freeze
  orbitTurns: 1.15,       // how many circles before freeze
  finalAngle: -18,        // where to freeze relative to globe center
  finalNudge: {x: 0, y: 0}, // small px nudge if needed
};

const reduceMotion = matchMedia('(prefers-reduced-motion: reduce)').matches;

/** Helpers **/
function setFrozenPose(el, angleDeg){
  const radius = getComputedStyle(document.documentElement).getPropertyValue('--orbit-radius').trim() || '155px';
  el.style.transform = `translate(-50%,-50%) rotate(${angleDeg}deg) translateX(${radius}) rotate(${-angleDeg}deg)`;
  el.style.marginLeft = (C.finalNudge.x||0)+'px';
  el.style.marginTop  = (C.finalNudge.y||0)+'px';
}

function animateOrbitOnce(el, ms, turns, finalAngle){
  const radius = getComputedStyle(document.documentElement).getPropertyValue('--orbit-radius').trim() || '155px';
  const start = 0, end = 360 * turns;
  // If this is a <video>, make sure it plays during the orbit then pause on freeze
  if (el.tagName === 'VIDEO'){ el.currentTime = 0; el.play().catch(()=>{}); }
  const anim = el.animate([
    { transform: `translate(-50%,-50%) rotate(${start}deg) translateX(${radius}) rotate(${-start}deg)` },
    { transform: `translate(-50%,-50%) rotate(${end}deg) translateX(${radius}) rotate(${-end}deg)` }
  ], { duration: ms, easing: 'linear', iterations: 1, fill: 'forwards' });
  anim.addEventListener('finish', () => {
    if (el.tagName === 'VIDEO'){ el.pause(); }
    setFrozenPose(el, finalAngle);
    localStorage.setItem(C.key,'1');
  });
}

function addIntroFlyer(){
  const hero = document.getElementById('hero');
  // Try alpha video first, else fall back to animated webp
  let flyer;
  const alphaSrc = 'quetzal_alpha.webm';
  const webpSrc  = 'quetzal_flight.webp';

  // Create <video> if available
  flyer = document.createElement('video');
  flyer.src = alphaSrc; flyer.muted = true; flyer.playsInline = true;
  flyer.autoplay = true; flyer.className = 'intro-flyer';

  // If video errors (no file), swap to <img> webp
  flyer.onerror = () => {
    const img = document.createElement('img');
    img.src = webpSrc;
    img.alt = 'Quetzal';
    img.className = 'intro-flyer';
    hero.appendChild(img);
    setTimeout(()=> img.remove(), C.introMs + 80);
  };

  hero.appendChild(flyer);
  // Remove after glide completes
  setTimeout(()=> flyer.remove(), C.introMs + 80);
}

/** Main **/
window.addEventListener('DOMContentLoaded', () => {
  const seen = localStorage.getItem(C.key);
  const orbitBird = document.getElementById('orbitBird');

  if (reduceMotion){
    // Be still for users who request reduced motion
    if (orbitBird.tagName === 'VIDEO'){ orbitBird.pause(); }
    setFrozenPose(orbitBird, C.finalAngle);
    return;
  }

  if (!seen){
    // First visit: glide across hero, then orbit, then freeze
    addIntroFlyer();
    // Start orbit after the glide completes
    setTimeout(() => {
      animateOrbitOnce(orbitBird, C.orbitMs, C.orbitTurns, C.finalAngle);
    }, C.introMs + 60);
  } else {
    // Subsequent visits: frozen
    setFrozenPose(orbitBird, C.finalAngle);
  }
});
</script>
</body>
</html>
